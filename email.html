<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Section with Update Popup</title>
    <link rel="stylesheet" href="email.css">
    <link rel="stylesheet" href="styles.css">
    
</head>
<body>
    <div class="navbar">
        <span>My Website</span>
        <img src="menu.png" alt="Menu" class="open-btn" onclick="toggleDrawer()" />
    </div>

    <div id="drawer" class="drawer">
        <a href="#" onclick="toggleSubMenu('home-submenu')">Contact</a>
        <div id="home-submenu" class="submenu">
            <a href="phone.html">Phone</a>
            <a href="email.html">Email</a>
        </div>
        <a href="#">About</a>
        <a href="#">Services</a>
        <a href="#">Contact</a>
    </div>

    <div class="container">
        <div class="cardmaster-table-card">
            <div class="card-header">
                <h1>Master Table</h1>
                <div class="table-actions">
                    <div class="upload-dropdown">
                        <select class="upload-select" onchange="handleUploadSelection(this)">
                            <option value="" disabled selected>Select File to Upload&nbsp; &nbsp;▼</option>
                            <option value="bulk">Bulk Upload</option>
                            <option value="single-update">Single Update</option>
                            <option value="single-add">Add New Email</option>
                        </select>
                    </div>
                    <input type="text" id="searchInput" placeholder="Search emails..." onkeyup="filterEmails()" />
                </div>
            </div>
            <div class="card-body">
                <table id="emailTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Subject</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>John Doe</td>
                            <td>john.doe@example.com</td>
                            <td>Meeting Update</td>
                            <td>
                                <button class="update-btn" onclick="openSingleUpdatePopup(this)">Update</button>
                                <button class="delete-btn" onclick="deleteEmail(this)">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Jane Smith</td>
                            <td>jane.smith@example.com</td>
                            <td>Project Proposal</td>
                            <td>
                                <button class="update-btn" onclick="openSingleUpdatePopup(this)">Update</button>
                                <button class="delete-btn" onclick="deleteEmail(this)">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="updatePopup" class="popup">
            <div class="popup-content">
                <h2>Update Email</h2>
                <label for="updateName">Name:</label>
                <input type="text" id="updateName" />
                <label for="updateEmail">Email:</label>
                <input type="email" id="updateEmail" />
                <label for="updateSubject">Subject:</label>
                <input type="text" id="updateSubject" />
                <div class="popup-buttons">
                    <button onclick="closePopup()">Close</button>
                    <button onclick="saveUpdate()">Save</button>
                </div>
            </div>
        </div>

        <div id="bulkUploadPopup" class="bulk-upload-popup">
            <div class="bulk-upload-popup-header">
                <h2>Bulk Upload CSV</h2>
                <span class="close-button" onclick="closeBulkUploadPopup()">×</span>
            </div>
            <div class="bulk-upload-popup-content">
                <input type="file" id="bulkUploadInput" accept=".csv">
                <div class="popup-buttons">
                    <button onclick="closeBulkUploadPopup()">Cancel</button>
                    <button onclick="handleBulkFileUpload()">Upload</button>
                </div>
            </div>
        </div>
        <div id="overlay" class="overlay"></div>

        <div id="singleUpdatePopup" class="single-update-popup">
            <div class="single-update-popup-header">
                <h2>Edit Email Details</h2>
                <span class="close-button" onclick="closeSingleUpdatePopup()">×</span>
            </div>
            <div class="single-update-popup-content">
                <label for="singleUpdateName">Name:</label>
                <input type="text" id="singleUpdateName" />
                <label for="singleUpdateEmail">Email:</label>
                <input type="email" id="singleUpdateEmail" />
                <label for="singleUpdateSubject">Subject:</label>
                <input type="text" id="singleUpdateSubject" />
            </div>
            <div class="single-update-popup-buttons">
                <button onclick="closeSingleUpdatePopup()">Cancel</button>
                <button onclick="saveSingleUpdate()">Save</button>
            </div>
        </div>

        <div id="singleAddPopup" class="single-update-popup">
            <div class="single-update-popup-header">
                <h2>Add New Email</h2>
                <span class="close-button" onclick="closeSingleAddPopup()">×</span>
            </div>
            <div class="single-update-popup-content">
                <label for="addName">Name:</label>
                <input type="text" id="addName" />
                <label for="addEmail">Email:</label>
                <input type="email" id="addEmail" />
                <label for="addSubject">Subject:</label>
                <input type="text" id="addSubject" />
            </div>
            <div class="single-update-popup-buttons">
                <button onclick="closeSingleAddPopup()">Cancel</button>
                <button onclick="saveNewEmail()">Add</button>
            </div>
        </div>
    </div>

    <script src="drawer.js"></script>
    <script src="email.js"></script>
    <script>
        const bulkUploadPopup = document.getElementById('bulkUploadPopup');
        const overlay = document.getElementById('overlay');
        const uploadSelect = document.querySelector('.upload-select');
        const bulkUploadInput = document.getElementById('bulkUploadInput');
        const singleUpdatePopup = document.getElementById('singleUpdatePopup');
        const singleAddPopup = document.getElementById('singleAddPopup');

        let currentRowToUpdate = null; // To keep track of which row is being edited

        function handleUploadSelection(selectElement) {
            const value = selectElement.value;
            if (value === 'bulk') {
                openBulkUploadPopup();
            } else if (value === 'single-update') {
                console.log('Single Update selected from dropdown. Consider row selection.');
                alert('Please click the "Update" button next to the email you want to edit.');
            } else if (value === 'single-add') {
                openSingleAddPopup(); // Call a new function to open the add form
            }
            selectElement.value = ''; // Reset the dropdown after selection
        }

        function openBulkUploadPopup() {
            bulkUploadPopup.style.display = 'block';
            overlay.style.display = 'block';
        }

        function closeBulkUploadPopup() {
            bulkUploadPopup.style.display = 'none';
            overlay.style.display = 'none';
            bulkUploadInput.value = '';
        }

        function handleBulkFileUpload() {
            const file = bulkUploadInput.files[0];
            if (file) {
                console.log('Selected CSV file:', file);
                alert('CSV file selected. Implement bulk processing.');
                closeBulkUploadPopup();
                // Implement your CSV file reading and processing logic here
            } else {
                alert('Please select a CSV file.');
            }
        }

        function openSingleUpdatePopup(updateButton) {
            currentRowToUpdate = updateButton.parentNode.parentNode; // Get the table row
            const cells = currentRowToUpdate.querySelectorAll('td');
            const name = cells[0].textContent;
            const email = cells[1].textContent;
            const subject = cells[2].textContent;

            document.getElementById('singleUpdateName').value = name;
            document.getElementById('singleUpdateEmail').value = email;
            document.getElementById('singleUpdateSubject').value = subject;

            singleUpdatePopup.style.display = 'block';
            overlay.style.display = 'block';
        }

        function closeSingleUpdatePopup() {
            singleUpdatePopup.style.display = 'none';
            overlay.style.display = 'none';
            currentRowToUpdate = null; // Reset the tracked row
        }

        function saveSingleUpdate() {
            if (currentRowToUpdate) {
                const name = document.getElementById('singleUpdateName').value;
                const email = document.getElementById('singleUpdateEmail').value;
                const subject = document.getElementById('singleUpdateSubject').value;

                const cellsToUpdate = currentRowToUpdate.querySelectorAll('td');
                cellsToUpdate[0].textContent = name;
                cellsToUpdate[1].textContent = email;
                cellsToUpdate[2].textContent = subject;

                closeSingleUpdatePopup();
                alert('Email details updated!'); // Provide user feedback
            }
        }

        function openSingleAddPopup() {
            // Clear any previous values in the form
            document.getElementById('addName').value = '';
            document.getElementById('addEmail').value = '';
            document.getElementById('addSubject').value = '';

            singleAddPopup.style.display = 'block';
            overlay.style.display = 'block';
        }

        function closeSingleAddPopup() {
            singleAddPopup.style.display = 'none';
            overlay.style.display = 'none';
        }

        function saveNewEmail() {
            const name = document.getElementById('addName').value;
            const email = document.getElementById('addEmail').value;
            const subject = document.getElementById('addSubject').value;
            const emailTableBody = document.querySelector('#emailTable tbody');

            // Create a new table row
            const newRow = emailTableBody.insertRow();

            // Insert cells for Name, Email, Subject, and Actions
            const nameCell = newRow.insertCell();
            const emailCell = newRow.insertCell();
            const subjectCell = newRow.insertCell();
            const actionsCell = newRow.insertCell();

            nameCell.textContent = name;
            emailCell.textContent = email;
            subjectCell.textContent = subject;

            // Create the "Update" and "Delete" buttons for the new row
            const updateButton = document.createElement('button');
            updateButton.textContent = 'Update';
            updateButton.classList.add('update-btn');
            updateButton.onclick = function() { openSingleUpdatePopup(this); };

            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.classList.add('delete-btn');
            deleteButton.onclick = function() { deleteEmail(this); }; // Assuming you have a deleteEmail function

            actionsCell.appendChild(updateButton);
            actionsCell.appendChild(document.createTextNode(' ')); // Add a space between buttons
            actionsCell.appendChild(deleteButton);

            closeSingleAddPopup();
            alert('New email added!'); // Provide user feedback
        }

        overlay.addEventListener('click', () => {
            closeBulkUploadPopup();
            closeSingleUpdatePopup();
            closeSingleAddPopup();
        });

        // Placeholder for deleteEmail function
        function deleteEmail(deleteButton) {
            const rowToDelete = deleteButton.parentNode.parentNode;
            rowToDelete.remove();
            alert('Email deleted!');
        }
    </script>
</body>
</html>